<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Categories | Campus Junction</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
  --primary: #FF6A3D;
  --secondary: rgb(240, 237, 97);
  --glass: rgba(255,255,255,0.15);
  --text-dark: #333;
  --border-color: #000;
}

* { box-sizing: border-box; margin:0; padding:0; font-family: 'Inter', sans-serif; }
body { background: #f5f5f5; color: var(--text-dark); padding-bottom: 100px; }

/* NAVIGATION */
nav {
  position: sticky; top:0;
  background:#fff; padding:0.7rem 1.5rem;
  display:flex; justify-content:space-between; align-items:center;
  z-index:1000;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
nav .logo { font-family:'Space Grotesk',sans-serif; font-size:1.4rem; font-weight:700; color:var(--primary);}
nav .links { display:flex; gap:1rem;}
nav .links a { text-decoration:none; color: var(--text-dark); font-weight:600;}
nav .search { display:flex; gap:0.5rem;}
nav button { padding:0.45rem 0.8rem; background: var(--primary); color:#fff; border:none; cursor:pointer; }

/* CATEGORY BUTTONS */
.categories { display:flex; gap:0.7rem; padding:1rem; overflow-x:auto; margin-top:0.5rem;}
.categories button { padding:0.5rem 1rem; border:none; border-radius:12px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.1); cursor:pointer; transition:0.3s;}
.categories button.active, .categories button:hover { background: var(--primary); color:#fff;}

/* PRODUCTS GRID */
.products-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1rem; padding:1rem; }
.product-card { background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.1); position:relative; }
.product-card img { width:100%; height:170px; object-fit:cover; }
.product-info { padding:0.7rem; }
.product-info h4 { margin-bottom:0.3rem; }
.product-info p { color:#666; }
.product-actions { display:flex; justify-content:space-between; padding:0.5rem 0.7rem; }
.product-actions button { border:none; border-radius:8px; padding:0.4rem 0.6rem; cursor:pointer; transition:0.2s; }
.cart-btn { background: var(--secondary); color:#000; }
.cart-btn:hover { background: #e6b812; }
.chat-btn { background: var(--primary); color:#fff; }
.chat-btn:hover { background:#ff8350; }

/* LOADING SKELETONS */
.skeleton { background: #ddd; border-radius:8px; width:100%; height:170px; animation: pulse 1.2s infinite; }
@keyframes pulse { 0%{opacity:0.6;} 50%{opacity:1;} 100%{opacity:0.6;} }

/* FOOTER */
footer { background:#111; color:#fff; padding:2rem; text-align:center; }

/* MOBILE */
@media(max-width:770px){
  .products-grid { grid-template-columns:repeat(2,1fr); }
  .categories { padding:0.5rem; gap:0.5rem; }
}
/* ======================================================
   MOBILE CURVED BOTTOM NAV
   ====================================================== */

/* Hide by default (desktop & tablet) */
.bottom-nav,
.message-btn {
  display: none;
}

/* --- Bottom Navbar --- */
.bottom-nav {
  position: fixed;
  bottom: 0;
  width: 100%;
  height: 70px;
  justify-content: space-around;
  align-items: center;
  z-index: 900;
}

/* SVG border */
.bottom-nav svg {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
}

/* Nav links container */
.nav-links {
  position: fixed;
  display: flex;
  width: 100%;
  justify-content: space-around;
  z-index: 1;
}

/* Nav icons */
.nav-links a {
  color: var(--text-dark);
  font-size: 1.4rem;
  width: 50px;
  text-align: center;
  transition: 0.3s;
}

.nav-links a:hover {
  color: var(--primary);
}

/* --- Floating Messages Button --- */
.message-btn {
  position: fixed;
  bottom: 22px;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 60px;
  background: var(--glass);
  backdrop-filter: blur(20px);
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  color: var(--primary);
  font-size: 1.5rem;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  border: 2px solid var(--primary);
  z-index: 1000;
}

/* Badge */
.message-btn .badge {
  position: fixed;
  top: 5px;
  right: 5px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: red;
  color: #fff;
  font-size: 0.7rem;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ================= MOBILE ONLY ================= */
@media (max-width:770px) {

  /* Show curved nav ONLY on mobile */
  .bottom-nav,
  .message-btn {
    display: flex;
  }

  body {
    padding-bottom: 95px;
  }

  nav .links {
    display: none;
  }

  /* Products â†’ 2 per row */
  .products-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .products {
    padding: 1rem;
  }
  .sign-up{
     border:none;
     background-color:var(--primary);
  }
}
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="logo">Campus Junction</div>
  <div class="links">
    <a href="index.html">Home</a>
    <a href="#">Messages</a>
    <a href="#">Shops</a>
    <a href="#">Offers</a>
  </div>
  <div class="search">
    <button class="sign-up">Sign Up</button>
  </div>
</nav>

<!-- CATEGORY FILTER -->
<div class="categories">
  <button class="active" onclick="filterProducts('all', this)">All</button>
  <button onclick="filterProducts('Electronics', this)">Electronics</button>
  <button onclick="filterProducts('Fashion', this)">Fashion</button>
  <button onclick="filterProducts('Books', this)">Books</button>
  <button onclick="filterProducts('Food', this)">Food</button>
  <button onclick="filterProducts('Services', this)">Services</button>
</div>

<!-- PRODUCTS GRID -->
<div class="products-grid" id="productsGrid">
  <!-- Loading skeletons while fetching -->
  <div class="skeleton"></div>
  <div class="skeleton"></div>
  <div class="skeleton"></div>
  <div class="skeleton"></div>
</div>

<footer>
  Â© Campus Junction â€¢ All rights reserved
</footer>

<!-- ===== MOBILE BOTTOM NAV ===== -->
<div class="bottom-nav">
  <svg viewBox="0 0 400 50" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0 H120 Q200 100 280 0 H450 V70 H0 Z"
          fill="rgb(240, 237, 97)"
          stroke="black"
          stroke-width="0"/>
  </svg>

  <div class="nav-links">
    <a href="index.html"><i class="fas fa-home"></i></a>
    <a href="category.html"><i class="fas fa-layer-group"></i></a>
    <div style="width:60px"></div>
    <a href="cart.html"><i class="fas fa-shopping-cart"></i></a>
    <a href="account.html"><i class="fas fa-user"></i></a>
  </div>
</div>

<div class="message-btn">
  <i class="fas fa-comment"></i>
  <span class="badge">3</span>
</div>

<script>
const API = "https://campusbackend-bq3r.onrender.com/api/public/products"; // Backend route
const grid = document.getElementById("productsGrid");
let products = [];
const token = localStorage.getItem("sellerToken"); // Only used to protect buttons

// Fetch products from backend
async function fetchProducts() {
  try {
    const res = await fetch(API, {
      headers: token ? { "Authorization": "Bearer " + token } : {}
    });
    if (!res.ok) throw new Error("Failed to load products");
    products = await res.json();
    renderProducts(products);
  } catch (err) {
    console.error(err);
    grid.innerHTML = "<p style='padding:1rem;'>Failed to load products</p>";
  }
}

// Render products
function renderProducts(list) {
  if (!list.length) {
    grid.innerHTML = "<p style='padding:1rem;'>No products found</p>";
    return;
  }

  grid.innerHTML = "";
  list.forEach(p => {
    const img = p.images && p.images.length ? p.images[0].url : "https://via.placeholder.com/300";
    const card = document.createElement("div");
    card.classList.add("product-card");
    card.innerHTML = `
      <img src="${img}">
      <div class="product-info">
        <h4>${p.name}</h4>
        <p>KES ${p.price}</p>
      </div>
      <div class="product-actions">
        <button class="cart-btn" onclick="handleCart('${p._id}')">
          <i class="fas fa-cart-plus"></i>
        </button>
        <button class="chat-btn" onclick="handleChat('${p.seller._id}', '${p._id}')">
          <i class="fas fa-comment"></i>
        </button>
      </div>
    `;
    grid.appendChild(card);
  });
}

// Filter products
function filterProducts(category, btn) {
  document.querySelectorAll(".categories button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  if (category === "all") renderProducts(products);
  else renderProducts(products.filter(p => p.category === category));
}

// Protected Add to Cart
function handleCart(productId) {
  if (!token) { alert("Please login to add to cart."); return; }
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  if (!cart.includes(productId)) cart.push(productId);
  localStorage.setItem("cart", JSON.stringify(cart));
  alert("Added to cart ðŸ›’");
}

// Protected Contact Seller
function handleChat(sellerId, productId) {
  if (!token) { alert("Please login to contact seller."); return; }
  window.location.href = `messages.html?seller=${sellerId}&product=${productId}`;
}

// Initialize
fetchProducts();
</script>

</body>
</html>
